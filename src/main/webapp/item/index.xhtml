<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:util="http://code.adi3000.com/common/web/jsf/util" >
<body>
	<ui:composition template="/home/template/mainLayout.xhtml">
		<f:metadata>
		    <f:viewParam name="r" value="#{itemSearchBean.itemFilter.pattern}"/>            
		    <f:viewParam name="p" value="#{itemSearchBean.page}"/>            
	 		<f:event listener="#{itemSearchBean.loadSearch}" type="preRenderView" />
	 		<f:event listener="#{itemSearchBean.fillPubItems}" type="preRenderView" />
	 	</f:metadata>
		<ui:define name="mainDiv"> 
		 	<h:outputScript name="js/item.js" target="head" /> 
		 	<h:outputStylesheet name="css/item.css" target="head" /> 
		 	<h:outputScript target="head">
		 	$(function(){
		 		$("#itemList .itemImages").cycle();
		 	})
		 	</h:outputScript>
		 	<!-- <h:outputScript target="head" >
				$(function() {
					showLoadingDiv("Recherche en cours... Veuillez patienter...");
					var result = $.getJSON("#{facesContext.externalContext.requestContextPath}/rest/search/item", {
						r : "#{itemSearchBean.itemFilter.pattern}", 
						p : "#{itemSearchBean.page}",
						c : "#{itemSearchBean.itemFilter.keywordId}"
						}, 
						function(data){
							$("#itemList").addItems(data);
							hideLoadingDiv();
						});		
				});
	 		</h:outputScript> -->
			<div>
				<h1>
					Résultat de la recherche "#{itemSearchBean.itemFilter.pattern}" : #{itemSearchBean.count} résultats
				</h1>
			</div>
			<div id="itemList">
				<ui:repeat var="item" value="#{itemSearchBean.itemsFound}">
					<div class="item">
						<div class="itemImages" >
							<ui:repeat var="image" value="#{item.imageList}">
								<h:graphicImage value="/image/p/s/#{image.name}" />
							</ui:repeat> 
						</div>
						<div class="itemInfoDetails">
							<div class="itemInfos" >
								<div class="date">
								<span>déposé le</span>
								<span>
									<h:outputText value="#{item.updateDate}" >
								    	<f:convertDateTime pattern="dd/MM/yyyy HH:mm" />
									</h:outputText>
								</span>
								</div>
								<div class="login">par <span>#{item.user.login}</span></div>
								<h:panelGroup rendered="#{item.user.place != null}">
									<div class="place">#{item.user.place.name}</div>
								</h:panelGroup>
							</div>
							<div class="itemDetails">
								<h2 class="itemTitle" >
									<h:link outcome="/item/viewItem" value="#{item.title}">
										<f:param name="item" value="#{item.id}" />
									</h:link>
								</h2>
								<div class="itemDescription" >#{util:limit(item.description,200)}</div>
								<ul class="itemWishies" />
							</div>
						</div>
					</div>
				</ui:repeat>
				<div id="addItems" style="display:none;">
					<div class="item">
						<div class="itemImages" />
						<div class="itemInfos" />
						<div class="itemDetails">
							<h2 class="itemTitle" />
							<p class="itemDescription" />
							<ul class="itemWishies" />
						</div>
					</div>
				</div>
			</div>
		</ui:define>
	</ui:composition>
</body>
</html>